const express = require('express');
const expressWebSocket = require('express-ws');
const websocketStream = require('websocket-stream/stream');
const app = express();

var providerWS = null
var consumerWS = {}
var lastConsumerId = 0

// temporario
var currentDataSent = 0
let data = [
    "{ \"latitude\" : -30.0750319, \"longitude\" : -51.13493587, \"direction\": 180.02666665913875, \"test\" : -0.026666659138754767, \"bearing\" : 301.9 }",
    "{ \"latitude\" : -30.07498522, \"longitude\" : -51.13502731, \"direction\": 180.0099990177064, \"test\" : -0.03666567684516053, \"bearing\" : 301.1 }",
    "{ \"latitude\" : -30.07493741, \"longitude\" : -51.13511029, \"direction\": 180.00907219823623, \"test\" : -0.04573787508138594, \"bearing\" : 301.8 }",
    "{ \"latitude\" : -30.07487994, \"longitude\" : -51.13520824, \"direction\": 180.01070663642497, \"test\" : -0.05644451150635632, \"bearing\" : 302.6 }",
    "{ \"latitude\" : -30.07482553, \"longitude\" : -51.13531194, \"direction\": 180.0113326070918, \"test\" : -0.06777711859814417, \"bearing\" : 301.2 }",
    "{ \"latitude\" : -30.07476377, \"longitude\" : -51.13542066, \"direction\": 180.01187846628812, \"test\" : -0.07965558488626812, \"bearing\" : 299.2 }",
    "{ \"latitude\" : -30.07471032, \"longitude\" : -51.13553879, \"direction\": 180.01290357913308, \"test\" : -0.09255916401934883, \"bearing\" : 300.8 }",
    "{ \"latitude\" : -30.07464744, \"longitude\" : -51.13564788, \"direction\": 180.01191337753008, \"test\" : -0.10447254154942698, \"bearing\" : 301.1 }",
    "{ \"latitude\" : -30.07458565, \"longitude\" : -51.13576738, \"direction\": 180.01304696569449, \"test\" : -0.11751950724391236, \"bearing\" : 300.8 }",
    "{ \"latitude\" : -30.07452319, \"longitude\" : -51.13587787, \"direction\": 180.01206026414854, \"test\" : -0.12957977139245713, \"bearing\" : 301.4 }",
    "{ \"latitude\" : -30.07446201, \"longitude\" : -51.13600533, \"direction\": 180.01390914192402, \"test\" : -0.1434889133164745, \"bearing\" : 300.8 }",
    "{ \"latitude\" : -30.07440138, \"longitude\" : -51.13612571, \"direction\": 180.01313333539946, \"test\" : -0.15662224871593367, \"bearing\" : 301.3 }",
    "{ \"latitude\" : -30.07433874, \"longitude\" : -51.13624952, \"direction\": 180.0135042266293, \"test\" : -0.17012647534522785, \"bearing\" : 301.3 }",
    "{ \"latitude\" : -30.07427021, \"longitude\" : -51.13637558, \"direction\": 180.01374605817327, \"test\" : -0.18387253351849608, \"bearing\" : 301.4 }",
    "{ \"latitude\" : -30.07420405, \"longitude\" : -51.1364963, \"direction\": 180.01316021840063, \"test\" : -0.1970327519191244, \"bearing\" : 300.9 }",
    "{ \"latitude\" : -30.07413736, \"longitude\" : -51.13662304, \"direction\": 180.01381282452954, \"test\" : -0.2108455764486621, \"bearing\" : 300.8 }",
    "{ \"latitude\" : -30.07406917, \"longitude\" : -51.13674514, \"direction\": 180.01330355632228, \"test\" : -0.22414913277094684, \"bearing\" : 301.4 }",
    "{ \"latitude\" : -30.07400691, \"longitude\" : -51.13686541, \"direction\": 180.01310073877727, \"test\" : -0.2372498715482152, \"bearing\" : 301.5 }",
    "{ \"latitude\" : -30.07394156, \"longitude\" : -51.13698796, \"direction\": 180.0133457077053, \"test\" : -0.2505955792535133, \"bearing\" : 301.5 }",
    "{ \"latitude\" : -30.07387898, \"longitude\" : -51.13711609, \"direction\": 180.01394980300623, \"test\" : -0.26454538225974034, \"bearing\" : 302.8 }",
    "{ \"latitude\" : -30.07381735, \"longitude\" : -51.13723044, \"direction\": 180.012446459016, \"test\" : -0.2769918412757306, \"bearing\" : 304.4 }",
    "{ \"latitude\" : -30.07374425, \"longitude\" : -51.13733748, \"direction\": 180.01164770487975, \"test\" : -0.2886395461554798, \"bearing\" : 305.7 }",
    "{ \"latitude\" : -30.07367344, \"longitude\" : -51.13745092, \"direction\": 180.01234058486222, \"test\" : -0.3009801310176954, \"bearing\" : 305.7 }",
    "{ \"latitude\" : -30.07359786, \"longitude\" : -51.13755576, \"direction\": 180.0114017216011, \"test\" : -0.3123818526187847, \"bearing\" : 306.8 }",
    "{ \"latitude\" : -30.07352547, \"longitude\" : -51.137667, \"direction\": 180.01209417184592, \"test\" : -0.32447602446470114, \"bearing\" : 306.8 }",
    "{ \"latitude\" : -30.07344014, \"longitude\" : -51.13778427, \"direction\": 180.01274580010957, \"test\" : -0.3372218245742715, \"bearing\" : 309.4 }",
    "{ \"latitude\" : -30.07336113, \"longitude\" : -51.13789144, \"direction\": 180.0116442294519, \"test\" : -0.34886605402616055, \"bearing\" : 310.2 }",
    "{ \"latitude\" : -30.07328164, \"longitude\" : -51.13799325, \"direction\": 180.01105836964135, \"test\" : -0.35992442366750765, \"bearing\" : 311.2 }",
    "{ \"latitude\" : -30.0731981, \"longitude\" : -51.13809573, \"direction\": 180.0111275466606, \"test\" : -0.37105197032809656, \"bearing\" : 311.9 }",
    "{ \"latitude\" : -30.07310766, \"longitude\" : -51.13820163, \"direction\": 180.0114949423604, \"test\" : -0.38254691268849683, \"bearing\" : 312.9 }",
    "{ \"latitude\" : -30.07302962, \"longitude\" : -51.13831039, \"direction\": 180.01180139546057, \"test\" : -0.39434830814906263, \"bearing\" : 312.7 }",
    "{ \"latitude\" : -30.07294769, \"longitude\" : -51.13841257, \"direction\": 180.01108389663915, \"test\" : -0.4054322047882124, \"bearing\" : 312.7 }",
    "{ \"latitude\" : -30.07285796, \"longitude\" : -51.13853125, \"direction\": 180.01286935776992, \"test\" : -0.41830156255812767, \"bearing\" : 310.9 }",
    "{ \"latitude\" : -30.07277871, \"longitude\" : -51.13863642, \"direction\": 180.01140051453228, \"test\" : -0.4297020770904112, \"bearing\" : 310.9 }",
    "{ \"latitude\" : -30.07270302, \"longitude\" : -51.13873609, \"direction\": 180.01080097944615, \"test\" : -0.4405030565365564, \"bearing\" : 311.6 }",
    "{ \"latitude\" : -30.07262325, \"longitude\" : -51.13883946, \"direction\": 180.01119849551912, \"test\" : -0.4517015520556811, \"bearing\" : 311.6 }",
    "{ \"latitude\" : -30.07254827, \"longitude\" : -51.13893826, \"direction\": 180.01070011214992, \"test\" : -0.4624016642056006, \"bearing\" : 314.0 }",
    "{ \"latitude\" : -30.07248325, \"longitude\" : -51.13902793, \"direction\": 180.00970860836748, \"test\" : -0.4721102725730759, \"bearing\" : 313.1 }",
    "{ \"latitude\" : -30.0724091, \"longitude\" : -51.13910452, \"direction\": 180.00829016215803, \"test\" : -0.48040043473110927, \"bearing\" : 312.9 }",
    "{ \"latitude\" : -30.07234751, \"longitude\" : -51.13917609, \"direction\": 180.0077446869061, \"test\" : -0.488145121637217, \"bearing\" : 311.7 }",
    "{ \"latitude\" : -30.07229355, \"longitude\" : -51.13924153, \"direction\": 180.0070797176692, \"test\" : -0.4952248393064167, \"bearing\" : 312.4 }",
    "{ \"latitude\" : -30.07223212, \"longitude\" : -51.13931271, \"direction\": 180.0076989614447, \"test\" : -0.5029238007511196, \"bearing\" : 312.5 }",
    "{ \"latitude\" : -30.0721863, \"longitude\" : -51.13937909, \"direction\": 180.00717823333747, \"test\" : -0.5101020340885896, \"bearing\" : 313.1 }",
    "{ \"latitude\" : -30.07212231, \"longitude\" : -51.13943605, \"direction\": 180.00615825626826, \"test\" : -0.5162602903568541, \"bearing\" : 312.5 }",
    "{ \"latitude\" : -30.07207778, \"longitude\" : -51.13949292, \"direction\": 180.0061471770323, \"test\" : -0.5224074673891437, \"bearing\" : 313.7 }",
    "{ \"latitude\" : -30.0720404, \"longitude\" : -51.13953497, \"direction\": 180.0045445131195, \"test\" : -0.5269519805086418, \"bearing\" : 312.9 }",
    "{ \"latitude\" : -30.07202181, \"longitude\" : -51.13956532, \"direction\": 180.00327966912968, \"test\" : -0.5302316496383241, \"bearing\" : 313.4 }",
    "{ \"latitude\" : -30.07200214, \"longitude\" : -51.1395893, \"direction\": 180.00259112134216, \"test\" : -0.5328227709804878, \"bearing\" : 313.3 }",
    "{ \"latitude\" : -30.07203046, \"longitude\" : -51.13957371, \"direction\": 179.99831543723892, \"test\" : -0.5311382082194029, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.07202924, \"longitude\" : -51.13957671, \"direction\": 180.0003241818172, \"test\" : -0.5314623900366087, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.07202677, \"longitude\" : -51.1395708, \"direction\": 179.9993613662941, \"test\" : -0.5308237563307046, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.07202641, \"longitude\" : -51.13957122, \"direction\": 180.00004538485965, \"test\" : -0.530869141190351, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.07202658, \"longitude\" : -51.1395658, \"direction\": 179.99941431948463, \"test\" : -0.5302834606749798, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.07202946, \"longitude\" : -51.13956671, \"direction\": 180.00009833434356, \"test\" : -0.5303817950185419, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.07202892, \"longitude\" : -51.13955765, \"direction\": 179.9990209736266, \"test\" : -0.5294027686451557, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.07203049, \"longitude\" : -51.13955273, \"direction\": 179.99946834247507, \"test\" : -0.5288711111202247, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.07202719, \"longitude\" : -51.13954979, \"direction\": 179.99968230293248, \"test\" : -0.5285534140527091, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.07201441, \"longitude\" : -51.13956355, \"direction\": 180.00148686474955, \"test\" : -0.5300402788022609, \"bearing\" : 312.8 }",
    "{ \"latitude\" : -30.07200068, \"longitude\" : -51.13958061, \"direction\": 180.00184335668325, \"test\" : -0.5318836354855137, \"bearing\" : 312.8 }",
    "{ \"latitude\" : -30.07197048, \"longitude\" : -51.13963026, \"direction\": 180.0053643060648, \"test\" : -0.5372479415503051, \"bearing\" : 312.0 }",
    "{ \"latitude\" : -30.07194186, \"longitude\" : -51.13966986, \"direction\": 180.00427798038896, \"test\" : -0.5415259219392681, \"bearing\" : 312.1 }",
    "{ \"latitude\" : -30.07190622, \"longitude\" : -51.13971573, \"direction\": 180.004954705719, \"test\" : -0.5464806276582692, \"bearing\" : 313.2 }",
    "{ \"latitude\" : -30.07185953, \"longitude\" : -51.13977825, \"direction\": 180.006752094559, \"test\" : -0.5532327222172739, \"bearing\" : 311.3 }",
    "{ \"latitude\" : -30.07182149, \"longitude\" : -51.13984014, \"direction\": 180.00668292185688, \"test\" : -0.5599156440741524, \"bearing\" : 312.2 }",
    "{ \"latitude\" : -30.07176917, \"longitude\" : -51.13990648, \"direction\": 180.00716218028685, \"test\" : -0.5670778243610073, \"bearing\" : 312.2 }",
    "{ \"latitude\" : -30.071697, \"longitude\" : -51.13998732, \"direction\": 180.00872551872283, \"test\" : -0.5758033430838339, \"bearing\" : 311.6 }",
    "{ \"latitude\" : -30.07163445, \"longitude\" : -51.14006825, \"direction\": 180.00873288799488, \"test\" : -0.5845362310787152, \"bearing\" : 311.6 }",
    "{ \"latitude\" : -30.07155411, \"longitude\" : -51.14016579, \"direction\": 180.01052229138864, \"test\" : -0.5950585224673546, \"bearing\" : 312.8 }",
    "{ \"latitude\" : -30.07147367, \"longitude\" : -51.14025946, \"direction\": 180.0101016007803, \"test\" : -0.6051601232476571, \"bearing\" : 312.8 }",
    "{ \"latitude\" : -30.07139672, \"longitude\" : -51.14035518, \"direction\": 180.0103194621012, \"test\" : -0.6154795853488508, \"bearing\" : 312.8 }",
    "{ \"latitude\" : -30.07132174, \"longitude\" : -51.14046427, \"direction\": 180.0117573345705, \"test\" : -0.6272369199193406, \"bearing\" : 312.8 }",
    "{ \"latitude\" : -30.07124033, \"longitude\" : -51.14056301, \"direction\": 180.01063858088116, \"test\" : -0.6378755008005044, \"bearing\" : 313.0 }",
    "{ \"latitude\" : -30.07116165, \"longitude\" : -51.1406599, \"direction\": 180.01043595290466, \"test\" : -0.648311453705162, \"bearing\" : 313.0 }",
    "{ \"latitude\" : -30.07108348, \"longitude\" : -51.14075277, \"direction\": 180.0099998669496, \"test\" : -0.658311320654775, \"bearing\" : 312.5 }",
    "{ \"latitude\" : -30.07100355, \"longitude\" : -51.14084855, \"direction\": 180.01030999444814, \"test\" : -0.6686213151029108, \"bearing\" : 312.5 }",
    "{ \"latitude\" : -30.07092166, \"longitude\" : -51.14094657, \"direction\": 180.01054775413033, \"test\" : -0.6791690692332395, \"bearing\" : 312.1 }",
    "{ \"latitude\" : -30.07085342, \"longitude\" : -51.14104007, \"direction\": 180.01005835755453, \"test\" : -0.6892274267877667, \"bearing\" : 312.9 }",
    "{ \"latitude\" : -30.07077285, \"longitude\" : -51.14113621, \"direction\": 180.01033935725403, \"test\" : -0.6995667840417923, \"bearing\" : 312.6 }",
    "{ \"latitude\" : -30.07069361, \"longitude\" : -51.14123535, \"direction\": 180.01065863394547, \"test\" : -0.7102254179872602, \"bearing\" : 312.6 }",
    "{ \"latitude\" : -30.07061877, \"longitude\" : -51.14133142, \"direction\": 180.0103254327327, \"test\" : -0.7205508507199738, \"bearing\" : 312.9 }",
    "{ \"latitude\" : -30.07053761, \"longitude\" : -51.14142371, \"direction\": 180.0099161352407, \"test\" : -0.7304669859606747, \"bearing\" : 314.3 }",
    "{ \"latitude\" : -30.07045867, \"longitude\" : -51.14151653, \"direction\": 180.00996993565244, \"test\" : -0.7404369216131101, \"bearing\" : 314.3 }",
    "{ \"latitude\" : -30.07041008, \"longitude\" : -51.14158935, \"direction\": 180.0078196888618, \"test\" : -0.7482566104748969, \"bearing\" : 313.7 }",
    "{ \"latitude\" : -30.07033787, \"longitude\" : -51.14167807, \"direction\": 180.00952488127635, \"test\" : -0.7577814917512455, \"bearing\" : 314.7 }",
    "{ \"latitude\" : -30.0702723, \"longitude\" : -51.14175421, \"direction\": 180.00817208022224, \"test\" : -0.7659535719734833, \"bearing\" : 314.7 }",
    "{ \"latitude\" : -30.07019939, \"longitude\" : -51.14183549, \"direction\": 180.0087213958736, \"test\" : -0.7746749678470906, \"bearing\" : 314.6 }",
    "{ \"latitude\" : -30.07014468, \"longitude\" : -51.14189975, \"direction\": 180.00689338129484, \"test\" : -0.781568349141935, \"bearing\" : 312.9 }",
    "{ \"latitude\" : -30.0700885, \"longitude\" : -51.14196768, \"direction\": 180.0072854897456, \"test\" : -0.7888538388875475, \"bearing\" : 312.8 }",
    "{ \"latitude\" : -30.07003224, \"longitude\" : -51.1420455, \"direction\": 180.00834434932963, \"test\" : -0.7971981882171804, \"bearing\" : 312.4 }",
    "{ \"latitude\" : -30.06997676, \"longitude\" : -51.14211525, \"direction\": 180.00747739131876, \"test\" : -0.8046755795359388, \"bearing\" : 312.4 }",
    "{ \"latitude\" : -30.06991065, \"longitude\" : -51.1421987, \"direction\": 180.00894395607796, \"test\" : -0.8136195356138956, \"bearing\" : 312.2 }",
    "{ \"latitude\" : -30.06984771, \"longitude\" : -51.14228039, \"direction\": 180.0087531003991, \"test\" : -0.8223726360130001, \"bearing\" : 312.0 }",
    "{ \"latitude\" : -30.06978585, \"longitude\" : -51.14235938, \"direction\": 180.00846172065073, \"test\" : -0.8308343566637291, \"bearing\" : 312.0 }",
    "{ \"latitude\" : -30.0697285, \"longitude\" : -51.14245565, \"direction\": 180.01031040054622, \"test\" : -0.8411447572099462, \"bearing\" : 307.0 }",
    "{ \"latitude\" : -30.06966692, \"longitude\" : -51.14255385, \"direction\": 180.01051465898487, \"test\" : -0.8516594161948206, \"bearing\" : 306.5 }",
    "{ \"latitude\" : -30.06960821, \"longitude\" : -51.14263739, \"direction\": 180.00894284013614, \"test\" : -0.8606022563309637, \"bearing\" : 306.0 }",
    "{ \"latitude\" : -30.06954744, \"longitude\" : -51.14271395, \"direction\": 180.0081937256994, \"test\" : -0.8687959820303774, \"bearing\" : 307.2 }",
    "{ \"latitude\" : -30.0694964, \"longitude\" : -51.14279203, \"direction\": 180.0083545519949, \"test\" : -0.8771505340252759, \"bearing\" : 305.4 }",
    "{ \"latitude\" : -30.06945258, \"longitude\" : -51.14286684, \"direction\": 180.00800316142016, \"test\" : -0.8851536954454389, \"bearing\" : 305.7 }",
    "{ \"latitude\" : -30.06940541, \"longitude\" : -51.14293033, \"direction\": 180.0067909444444, \"test\" : -0.8919446398898287, \"bearing\" : 303.6 }",
    "{ \"latitude\" : -30.06937231, \"longitude\" : -51.14299538, \"direction\": 180.00695668698782, \"test\" : -0.8989013268776489, \"bearing\" : 304.5 }",
    "{ \"latitude\" : -30.06934397, \"longitude\" : -51.14305168, \"direction\": 180.00602019872295, \"test\" : -0.9049215256005994, \"bearing\" : 302.7 }",
    "{ \"latitude\" : -30.06931806, \"longitude\" : -51.14310121, \"direction\": 180.0052957123154, \"test\" : -0.9102172379159867, \"bearing\" : 301.3 }",
    "{ \"latitude\" : -30.06928961, \"longitude\" : -51.14315424, \"direction\": 180.00566932972947, \"test\" : -0.9158865676454582, \"bearing\" : 300.7 }",
    "{ \"latitude\" : -30.06925737, \"longitude\" : -51.14321568, \"direction\": 180.0065676511586, \"test\" : -0.922454218804063, \"bearing\" : 299.6 }",
    "{ \"latitude\" : -30.0692341, \"longitude\" : -51.14326485, \"direction\": 180.0052554631097, \"test\" : -0.9277096819137682, \"bearing\" : 300.8 }",
    "{ \"latitude\" : -30.06922964, \"longitude\" : -51.14329479, \"direction\": 180.00319990529903, \"test\" : -0.9309095872127955, \"bearing\" : 297.3 }",
    "{ \"latitude\" : -30.06921971, \"longitude\" : -51.14331153, \"direction\": 180.00178907727857, \"test\" : -0.9326986644913688, \"bearing\" : 297.2 }",
    "{ \"latitude\" : -30.06922274, \"longitude\" : -51.14331353, \"direction\": 180.0002137452539, \"test\" : -0.9329124097452564, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922672, \"longitude\" : -51.14331661, \"direction\": 180.00032917213449, \"test\" : -0.9332415818797415, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922902, \"longitude\" : -51.14331767, \"direction\": 180.00011328795037, \"test\" : -0.9333548698301115, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922879, \"longitude\" : -51.14331725, \"direction\": 179.9999551121137, \"test\" : -0.9333099819438075, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922879, \"longitude\" : -51.14331727, \"direction\": 180.00000213751673, \"test\" : -0.9333121194605383, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922678, \"longitude\" : -51.14331766, \"direction\": 180.00004168144355, \"test\" : -0.9333538009040865, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922454, \"longitude\" : -51.14331703, \"direction\": 179.99993266899418, \"test\" : -0.9332864698982632, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922632, \"longitude\" : -51.143316, \"direction\": 179.99988991935078, \"test\" : -0.9331763892490414, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922636, \"longitude\" : -51.14331544, \"direction\": 179.99994015008983, \"test\" : -0.9331165393388687, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922549, \"longitude\" : -51.14331433, \"direction\": 179.99988136909516, \"test\" : -0.9329979084340323, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922549, \"longitude\" : -51.14331433, \"direction\": 180.0, \"test\" : -0.9329979084340323, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922503, \"longitude\" : -51.14331502, \"direction\": 180.0000737433366, \"test\" : -0.9330716517706321, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922503, \"longitude\" : -51.14331503, \"direction\": 180.00000106874225, \"test\" : -0.9330727205128824, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.0692253, \"longitude\" : -51.14331583, \"direction\": 180.0000854994747, \"test\" : -0.9331582199875754, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922527, \"longitude\" : -51.14331583, \"direction\": 180.0, \"test\" : -0.9331582199875754, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922527, \"longitude\" : -51.14331584, \"direction\": 180.00000106874404, \"test\" : -0.9331592887316162, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.06922516, \"longitude\" : -51.14331556, \"direction\": 179.99997007517527, \"test\" : -0.9331293639068861, \"bearing\" : 0.0 }",
    "{ \"latitude\" : -30.0692145, \"longitude\" : -51.14332961, \"direction\": 180.00150155694803, \"test\" : -0.9346309208549144, \"bearing\" : 300.7 }",
    "{ \"latitude\" : -30.06921455, \"longitude\" : -51.14333862, \"direction\": 180.00096289777724, \"test\" : -0.9355938186321566, \"bearing\" : 300.2 }",
    "{ \"latitude\" : -30.06919298, \"longitude\" : -51.14336618, \"direction\": 180.00294522501454, \"test\" : -0.9385390436466992, \"bearing\" : 295.8 }",
    "{ \"latitude\" : -30.06915742, \"longitude\" : -51.14338408, \"direction\": 180.00191269246076, \"test\" : -0.9404517361074625, \"bearing\" : 294.6 }",
    "{ \"latitude\" : -30.06914283, \"longitude\" : -51.1434207, \"direction\": 180.00391260260065, \"test\" : -0.9443643387081124, \"bearing\" : 294.6 }",
    "{ \"latitude\" : -30.06912255, \"longitude\" : -51.14347937, \"direction\": 180.00626807849204, \"test\" : -0.9506324172001541, \"bearing\" : 295.5 }",
    "{ \"latitude\" : -30.06909818, \"longitude\" : -51.14354034, \"direction\": 180.0065132388642, \"test\" : -0.9571456560643412, \"bearing\" : 296.1 }",
    "{ \"latitude\" : -30.069065, \"longitude\" : -51.14360949, \"direction\": 180.00738626667476, \"test\" : -0.9645319227390985, \"bearing\" : 295.8 }",
    "{ \"latitude\" : -30.06903271, \"longitude\" : -51.1436918, \"direction\": 180.0087908262446, \"test\" : -0.9733227489836906, \"bearing\" : 294.8 }",
    "{ \"latitude\" : -30.06900954, \"longitude\" : -51.14377252, \"direction\": 180.008620058844, \"test\" : -0.9819428078276928, \"bearing\" : 292.5 }",
    "{ \"latitude\" : -30.06900276, \"longitude\" : -51.14385467, \"direction\": 180.00877222112453, \"test\" : -0.9907150289522235, \"bearing\" : 289.9 }",
    "{ \"latitude\" : -30.06897236, \"longitude\" : -51.14395009, \"direction\": 180.0101885457429, \"test\" : -1.0009035746951156, \"bearing\" : 290.5 }",
    "{ \"latitude\" : -30.06894104, \"longitude\" : -51.14404615, \"direction\": 180.01025564671016, \"test\" : -1.0111592214052791, \"bearing\" : 290.5 }",
    "{ \"latitude\" : -30.06891176, \"longitude\" : -51.14416795, \"direction\": 180.01300217770662, \"test\" : -1.0241613991119038, \"bearing\" : 288.6 }",
    "{ \"latitude\" : -30.06887092, \"longitude\" : -51.14428263, \"direction\": 180.01224047075462, \"test\" : -1.0364018698665234, \"bearing\" : 291.0 }",
    "{ \"latitude\" : -30.068823, \"longitude\" : -51.14441279, \"direction\": 180.01389035479735, \"test\" : -1.0502922246638775, \"bearing\" : 289.7 }",
    "{ \"latitude\" : -30.06879286, \"longitude\" : -51.14453913, \"direction\": 180.01348058221575, \"test\" : -1.0637728068796264, \"bearing\" : 288.6 }",
    "{ \"latitude\" : -30.06874489, \"longitude\" : -51.14467553, \"direction\": 180.0145518310353, \"test\" : -1.0783246379149318, \"bearing\" : 289.1 }",
    "{ \"latitude\" : -30.06871298, \"longitude\" : -51.14480567, \"direction\": 180.01388176545714, \"test\" : -1.0922064033720744, \"bearing\" : 288.4 }",
    "{ \"latitude\" : -30.0686781, \"longitude\" : -51.1449424, \"direction\": 180.0145828144653, \"test\" : -1.1067892178373882, \"bearing\" : 288.4 }",
    "{ \"latitude\" : -30.06863641, \"longitude\" : -51.14506886, \"direction\": 180.01348548122044, \"test\" : -1.1202746990578305, \"bearing\" : 289.9 }",
    "{ \"latitude\" : -30.06860461, \"longitude\" : -51.1452112, \"direction\": 180.01517668498735, \"test\" : -1.135451384045183, \"bearing\" : 288.6 }",
    "{ \"latitude\" : -30.06855474, \"longitude\" : -51.14534551, \"direction\": 180.01431828020534, \"test\" : -1.1497696642505275, \"bearing\" : 289.3 }",
    "{ \"latitude\" : -30.0685158, \"longitude\" : -51.14547996, \"direction\": 180.0143306844346, \"test\" : -1.164100348685139, \"bearing\" : 289.4 }",
    "{ \"latitude\" : -30.06846658, \"longitude\" : -51.14560061, \"direction\": 180.01285759518709, \"test\" : -1.1769579438722246, \"bearing\" : 291.5 }",
    "{ \"latitude\" : -30.06842281, \"longitude\" : -51.14570339, \"direction\": 180.0109511993671, \"test\" : -1.1879091432393238, \"bearing\" : 292.6 }",
    "{ \"latitude\" : -30.06839696, \"longitude\" : -51.14580032, \"direction\": 180.01032643722064, \"test\" : -1.198235580459965, \"bearing\" : 290.9 }",
    "{ \"latitude\" : -30.06837995, \"longitude\" : -51.14589477, \"direction\": 180.01006136873767, \"test\" : -1.2082969491976314, \"bearing\" : 284.9 }",
    "{ \"latitude\" : -30.06835751, \"longitude\" : -51.14599629, \"direction\": 180.0108136878476, \"test\" : -1.219110637045219, \"bearing\" : 287.1 }",
    "{ \"latitude\" : -30.06833675, \"longitude\" : -51.1460878, \"direction\": 180.00974661952063, \"test\" : -1.2288572565658455, \"bearing\" : 289.1 }",
    "{ \"latitude\" : -30.06829582, \"longitude\" : -51.14617935, \"direction\": 180.0097497516876, \"test\" : -1.2386070082534388, \"bearing\" : 290.2 }",
    "{ \"latitude\" : -30.06826006, \"longitude\" : -51.14627279, \"direction\": 180.0099495300826, \"test\" : -1.2485565383360324, \"bearing\" : 290.9 }",
    "{ \"latitude\" : -30.06821647, \"longitude\" : -51.14637307, \"direction\": 180.01067622323063, \"test\" : -1.2592327615666647, \"bearing\" : 293.1 }",
    "{ \"latitude\" : -30.06819095, \"longitude\" : -51.14646089, \"direction\": 180.0093483818911, \"test\" : -1.2685811434577658, \"bearing\" : 290.4 }",
    "{ \"latitude\" : -30.06816482, \"longitude\" : -51.14656237, \"direction\": 180.0108013938775, \"test\" : -1.279382537335266, \"bearing\" : 289.3 }",
    "{ \"latitude\" : -30.06813186, \"longitude\" : -51.14664499, \"direction\": 180.00879296196757, \"test\" : -1.288175499302838, \"bearing\" : 291.9 }",
    "{ \"latitude\" : -30.06809804, \"longitude\" : -51.14673713, \"direction\": 180.00980486848528, \"test\" : -1.2979803677881137, \"bearing\" : 291.9 }",
    "{ \"latitude\" : -30.06806046, \"longitude\" : -51.14682836, \"direction\": 180.00970669060126, \"test\" : -1.3076870583893765, \"bearing\" : 295.4 }",
    "{ \"latitude\" : -30.06803044, \"longitude\" : -51.14692011, \"direction\": 180.00976071502262, \"test\" : -1.317447773411999, \"bearing\" : 292.5 }",
    "{ \"latitude\" : -30.06800149, \"longitude\" : -51.14700993, \"direction\": 180.00955429423337, \"test\" : -1.3270020676453669, \"bearing\" : 291.3 }",
    "{ \"latitude\" : -30.06797499, \"longitude\" : -51.14708871, \"direction\": 180.00837904235678, \"test\" : -1.335381110002146, \"bearing\" : 289.5 }",
    "{ \"latitude\" : -30.0679446, \"longitude\" : -51.14719009, \"direction\": 180.0107815935565, \"test\" : -1.3461627035586332, \"bearing\" : 292.1 }",
    "{ \"latitude\" : -30.06789337, \"longitude\" : -51.14728715, \"direction\": 180.01032057719786, \"test\" : -1.3564832807564926, \"bearing\" : 295.9 }",
    "{ \"latitude\" : -30.06784715, \"longitude\" : -51.14739275, \"direction\": 180.01122650857752, \"test\" : -1.3677097893340147, \"bearing\" : 294.7 }",
    "{ \"latitude\" : -30.06781881, \"longitude\" : -51.14747053, \"direction\": 180.00826768509452, \"test\" : -1.375977474428538, \"bearing\" : 293.4 }",
    "{ \"latitude\" : -30.0677888, \"longitude\" : -51.14753944, \"direction\": 180.00732401247095, \"test\" : -1.3833014868994837, \"bearing\" : 295.1 }",
    "{ \"latitude\" : -30.06775825, \"longitude\" : -51.14759231, \"direction\": 180.00561855969136, \"test\" : -1.3889200465908402, \"bearing\" : 298.2 }",
    "{ \"latitude\" : -30.06773248, \"longitude\" : -51.14764848, \"direction\": 180.00596859400227, \"test\" : -1.3948886405931091, \"bearing\" : 297.5 }",
    "{ \"latitude\" : -30.06770672, \"longitude\" : -51.14770466, \"direction\": 180.00596905801004, \"test\" : -1.4008576986031471, \"bearing\" : 297.9 }",
    "{ \"latitude\" : -30.06766388, \"longitude\" : -51.14774924, \"direction\": 180.00473595807597, \"test\" : -1.405593656679116, \"bearing\" : 307.8 }",
    "{ \"latitude\" : -30.06762767, \"longitude\" : -51.14779531, \"direction\": 180.00489348828438, \"test\" : -1.410487144963497, \"bearing\" : 311.1 }",
    "{ \"latitude\" : -30.06764251, \"longitude\" : -51.14779146, \"direction\": 179.99959108035392, \"test\" : -1.4100782253174202, \"bearing\" : 301.6 }",
    "{ \"latitude\" : -30.06761803, \"longitude\" : -51.14782656, \"direction\": 180.0037280360368, \"test\" : -1.4138062613542104, \"bearing\" : 303.6 }",
    "{ \"latitude\" : -30.06760196, \"longitude\" : -51.14785978, \"direction\": 180.0035280727244, \"test\" : -1.4173343340786175, \"bearing\" : 305.4 }",
    "{ \"latitude\" : -30.06756708, \"longitude\" : -51.14791304, \"direction\": 180.0056558499948, \"test\" : -1.4229901840734271, \"bearing\" : 307.6 }",
    "{ \"latitude\" : -30.06753679, \"longitude\" : -51.14796074, \"direction\": 180.00506476856975, \"test\" : -1.4280549526431798, \"bearing\" : 303.6 }",
    "{ \"latitude\" : -30.06750523, \"longitude\" : -51.14801413, \"direction\": 180.00566825058078, \"test\" : -1.4337232032239626, \"bearing\" : 298.6 }",
    "{ \"latitude\" : -30.06746354, \"longitude\" : -51.14807444, \"direction\": 180.00640202841558, \"test\" : -1.4401252316395414, \"bearing\" : 303.0 }",
    "{ \"latitude\" : -30.06743528, \"longitude\" : -51.1481328, \"direction\": 180.0061941707399, \"test\" : -1.4463194023794301, \"bearing\" : 300.2 }",
    "{ \"latitude\" : -30.0673994, \"longitude\" : -51.14818684, \"direction\": 180.00573495266437, \"test\" : -1.4520543550437992, \"bearing\" : 305.5 }",
    "{ \"latitude\" : -30.06738073, \"longitude\" : -51.14822497, \"direction\": 180.00404607160704, \"test\" : -1.4561004266508348, \"bearing\" : 301.7 }",
    "{ \"latitude\" : -30.06736364, \"longitude\" : -51.14825517, \"direction\": 180.0032043752347, \"test\" : -1.459304801885537, \"bearing\" : 303.9 }",
    "{ \"latitude\" : -30.06735408, \"longitude\" : -51.14828692, \"direction\": 180.00336865799306, \"test\" : -1.4626734598786015, \"bearing\" : 304.8 }",
    "{ \"latitude\" : -30.06734843, \"longitude\" : -51.14829979, \"direction\": 180.00136545854133, \"test\" : -1.4640389184199307, \"bearing\" : 302.6 }",
    "{ \"latitude\" : -30.06734639, \"longitude\" : -51.14830563, \"direction\": 180.00061959224539, \"test\" : -1.4646585106653163, \"bearing\" : 304.6 }"
]


// extend express app with app.ws()
expressWebSocket(app, null, {
    // ws options here
    perMessageDeflate: false,
});

app.set('port', (process.env.PORT || 5000));
app.listen(app.get('port'), function() {
  var port = app.get('port').toString();
  console.log("Running on port " + port);
});

app.get('/', function(req, res) {
    res.sendFile(__dirname + '/index.html');
});

// to connect
app.ws('/websocket', function(ws, req) {

    let id = makeConsumerId()

    consumerWS[id] = ws
    console.log("> Consumer " + id + " joined.\tTOTAL CONSUMERS: " + Object.keys(consumerWS).length);

    ws.onclose = function (e) {
        delete consumerWS[id];
        console.log("> Consumer " + id + " left.\tTOTAL CONSUMERS: " + Object.keys(consumerWS).length);
    }

});

app.ws('/websocket-provider', function(ws, req) {
    console.log(">>> Provider connected");
    providerWS = ws

    providerWS.onmessage = function (e) {
        broadcast(e.data);
    };

    providerWS.onclose = function (e) {
        console.log(">>> Provider disconnected");
        providerWS = null
    };
});

function makeConsumerId() {
    lastConsumerId += 1;
    return lastConsumerId
}

function broadcast(message) {
    for (var key in consumerWS) {
        consumerWS[key].send(message)
    }
}

setInterval(function() {
    broadcast(data[currentDataSent]);
    currentDataSent += 1;
    if (currentDataSent >= data.length) {
        currentDataSent = 0
    }
}, 200);
